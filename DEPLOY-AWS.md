# üöÄ Deploy AWS - ByteBank App

Este guia cont√©m todas as instru√ß√µes para fazer o deploy da aplica√ß√£o ByteBank na AWS usando Docker e ECS.

## üìã Pr√©-requisitos

### 1. Ferramentas Necess√°rias
- [Docker Desktop](https://www.docker.com/products/docker-desktop)
- [AWS CLI](https://aws.amazon.com/cli/)
- [Node.js 18+](https://nodejs.org/)
- Conta AWS ativa

### 2. Configura√ß√£o AWS
```bash
# Configure suas credenciais AWS
aws configure
```

Voc√™ precisar√°:
- AWS Access Key ID
- AWS Secret Access Key  
- Default region (ex: us-east-1)
- Default output format (json)

## üèóÔ∏è Op√ß√µes de Deploy

### Op√ß√£o 1: Deploy R√°pido com Script Automatizado

#### Windows:
```cmd
cd aws
deploy.bat production us-east-1
```

#### Linux/macOS:
```bash
cd aws
chmod +x deploy.sh
./deploy.sh production us-east-1
```

### Op√ß√£o 2: Deploy com CloudFormation (Recomendado)

#### 1. Criar Infraestrutura
```bash
# Deploy da infraestrutura
aws cloudformation create-stack \
  --stack-name bytebank-infrastructure \
  --template-body file://aws/cloudformation.yml \
  --parameters ParameterKey=Environment,ParameterValue=production \
  --capabilities CAPABILITY_IAM \
  --region us-east-1

# Aguardar cria√ß√£o (pode levar ~10 minutos)
aws cloudformation wait stack-create-complete \
  --stack-name bytebank-infrastructure \
  --region us-east-1
```

#### 2. Deploy da Aplica√ß√£o
```bash
# Executar script de deploy
cd aws
./deploy.sh production us-east-1
```

### Op√ß√£o 3: Deploy Manual Passo a Passo

#### 1. Criar Reposit√≥rio ECR
```bash
aws ecr create-repository --repository-name bytebank-app --region us-east-1
```

#### 2. Build e Push da Imagem
```bash
# Login no ECR
aws ecr get-login-password --region us-east-1 | docker login --username AWS --password-stdin <ACCOUNT_ID>.dkr.ecr.us-east-1.amazonaws.com

# Build da imagem
docker build -t bytebank-app .

# Tag e push
docker tag bytebank-app:latest <ACCOUNT_ID>.dkr.ecr.us-east-1.amazonaws.com/bytebank-app:latest
docker push <ACCOUNT_ID>.dkr.ecr.us-east-1.amazonaws.com/bytebank-app:latest
```

#### 3. Criar Cluster ECS
```bash
aws ecs create-cluster --cluster-name bytebank-cluster --region us-east-1
```

#### 4. Registrar Task Definition
```bash
# Editar aws/task-definition.json com seus valores
aws ecs register-task-definition --cli-input-json file://aws/task-definition.json --region us-east-1
```

#### 5. Criar Servi√ßo ECS
```bash
aws ecs create-service \
  --cluster bytebank-cluster \
  --service-name bytebank-service \
  --task-definition bytebank-app \
  --desired-count 2 \
  --launch-type FARGATE \
  --region us-east-1
```

## üîß Desenvolvimento Local com Docker

### Ambiente de Desenvolvimento
```bash
# Executar em modo desenvolvimento
docker-compose up app-dev

# Acessar: http://localhost:5173
```

### Ambiente de Produ√ß√£o Local
```bash
# Executar em modo produ√ß√£o
docker-compose up app-prod

# Acessar: http://localhost
```

### JSON Server (API Mock)
```bash
# Executar apenas o JSON Server
docker-compose up json-server

# API dispon√≠vel em: http://localhost:3001
```

## üîÑ CI/CD com GitHub Actions

### Configura√ß√£o
1. Adicione os secrets no GitHub:
   - `AWS_ACCESS_KEY_ID`
   - `AWS_SECRET_ACCESS_KEY`

2. Push para branch `main` ou `master` ir√°:
   - Executar testes
   - Build da aplica√ß√£o
   - Deploy autom√°tico na AWS

### Workflow
O arquivo `.github/workflows/deploy.yml` cont√©m:
- ‚úÖ Testes automatizados
- üî® Build da aplica√ß√£o
- üì¶ Push para ECR
- üöÄ Deploy no ECS
- üåê URL da aplica√ß√£o

## üìä Monitoramento

### CloudWatch Logs
```bash
# Ver logs da aplica√ß√£o
aws logs describe-log-groups --log-group-name-prefix "/ecs/bytebank-app"

# Stream de logs em tempo real
aws logs tail /ecs/bytebank-app --follow
```

### Status do Servi√ßo
```bash
# Status do cluster
aws ecs describe-clusters --clusters bytebank-cluster

# Status do servi√ßo
aws ecs describe-services --cluster bytebank-cluster --services bytebank-service

# Tasks em execu√ß√£o
aws ecs list-tasks --cluster bytebank-cluster --service-name bytebank-service
```

## üõ†Ô∏è Configura√ß√µes Avan√ßadas

### Escalabilidade
```bash
# Aumentar n√∫mero de inst√¢ncias
aws ecs update-service \
  --cluster bytebank-cluster \
  --service bytebank-service \
  --desired-count 4
```

### Rollback
```bash
# Listar task definitions
aws ecs list-task-definitions --family-prefix bytebank-app

# Fazer rollback para vers√£o anterior
aws ecs update-service \
  --cluster bytebank-cluster \
  --service bytebank-service \
  --task-definition bytebank-app:REVISION_NUMBER
```

## üîí Seguran√ßa

### HTTPS (Opcional)
Para habilitar HTTPS, adicione um certificado SSL no Application Load Balancer:

1. Obtenha um certificado SSL via AWS Certificate Manager
2. Configure o listener HTTPS no ALB
3. Redirecione HTTP para HTTPS

### Vari√°veis de Ambiente
Adicione vari√°veis sens√≠veis no Task Definition ou use AWS Systems Manager Parameter Store.

## üí∞ Custos Estimados

### Ambiente de Produ√ß√£o (mensal)
- **ECS Fargate**: ~$20-40 (2 inst√¢ncias)
- **Application Load Balancer**: ~$16
- **ECR**: ~$1-5 (dependendo do uso)
- **CloudWatch Logs**: ~$1-3
- **Total estimado**: ~$40-65/m√™s

### Otimiza√ß√£o de Custos
- Use FARGATE_SPOT para reduzir custos
- Configure lifecycle policies no ECR
- Ajuste retention de logs no CloudWatch
- Use Auto Scaling para otimizar recursos

## üÜò Troubleshooting

### Problemas Comuns

#### 1. Falha no Build Docker
```bash
# Verificar logs de build
docker build -t bytebank-app . --no-cache
```

#### 2. Falha no Deploy ECS
```bash
# Verificar eventos do servi√ßo
aws ecs describe-services --cluster bytebank-cluster --services bytebank-service

# Verificar logs das tasks
aws logs tail /ecs/bytebank-app --follow
```

#### 3. Health Check Falhando
- Verifique se o endpoint `/health` est√° respondendo
- Confirme se a porta 80 est√° exposta
- Verifique Security Groups

#### 4. Load Balancer n√£o acess√≠vel
- Verifique Security Groups
- Confirme se subnets s√£o p√∫blicas
- Verifique Target Group health

### Comandos √öteis

```bash
# Verificar status geral
aws ecs describe-clusters --clusters bytebank-cluster
aws ecs describe-services --cluster bytebank-cluster --services bytebank-service

# Logs em tempo real
aws logs tail /ecs/bytebank-app --follow

# Reiniciar servi√ßo
aws ecs update-service --cluster bytebank-cluster --service bytebank-service --force-new-deployment

# Conectar em task (debugging)
aws ecs execute-command \
  --cluster bytebank-cluster \
  --task TASK_ID \
  --container bytebank-frontend \
  --interactive \
  --command "/bin/sh"
```

## üìû Suporte

Para d√∫vidas ou problemas:

1. Verifique os logs no CloudWatch
2. Consulte a documenta√ß√£o AWS ECS
3. Abra uma issue no reposit√≥rio
4. Entre em contato com a equipe DevOps

---

## üéâ Parab√©ns!

Sua aplica√ß√£o ByteBank est√° agora rodando na AWS com:
- ‚úÖ Alta disponibilidade
- ‚úÖ Escalabilidade autom√°tica  
- ‚úÖ Monitoramento integrado
- ‚úÖ Deploy automatizado
- ‚úÖ Seguran√ßa enterprise

üåê **Acesse sua aplica√ß√£o**: `http://SEU_LOAD_BALANCER_DNS.amazonaws.com`
