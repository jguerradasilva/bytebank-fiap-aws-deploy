#!/bin/bash

# Script para configurar Duck DNS (Gratuito e Simples)
# N√£o precisa do AWS Route 53 - Economia de $0.50/m√™s

SUBDOMAIN="bytebank"
DOMAIN="bytebank.duckdns.org"
CURRENT_IP="34.204.75.66"

echo "ü¶Ü === Configurando Duck DNS para ByteBank App ==="
echo "Subdom√≠nio: $SUBDOMAIN"
echo "Dom√≠nio completo: $DOMAIN"
echo "IP de destino: $CURRENT_IP"
echo

echo "üìã PASSOS PARA CONFIGURAR DUCK DNS:"
echo
echo "1. Acesse: https://www.duckdns.org"
echo "2. Fa√ßa login com Google, GitHub ou Twitter"
echo "3. No campo 'subdomain', digite: $SUBDOMAIN"
echo "4. No campo 'ip', cole: $CURRENT_IP"
echo "5. Clique em 'add domain'"
echo
echo "‚úÖ PRONTO! O DNS funcionar√° em 1-2 minutos!"
echo
echo "üåê URLS QUE FUNCIONAR√ÉO:"
echo "- Principal: http://$DOMAIN"
echo "- API: http://$DOMAIN/api/extrato"
echo
echo "üîß COMANDOS PARA TESTAR:"
echo "nslookup $DOMAIN"
echo "curl -I http://$DOMAIN"
echo
echo "üí∞ CUSTO TOTAL: \$0 (Duck DNS √© 100% gratuito!)"
echo
echo "üéØ VANTAGENS DO DUCK DNS:"
echo "‚úÖ Gratuito para sempre"
echo "‚úÖ Funciona imediatamente (1-2 minutos)"
echo "‚úÖ Sem necessidade de Route 53"
echo "‚úÖ SSL gratuito dispon√≠vel"
echo "‚úÖ Renova√ß√£o autom√°tica"
echo "‚úÖ API para atualiza√ß√µes din√¢micas"

# Fun√ß√£o para verificar se o dom√≠nio j√° est√° funcionando
check_dns() {
    echo
    echo "üîç Verificando se o DNS j√° est√° funcionando..."
    if nslookup $DOMAIN > /dev/null 2>&1; then
        echo "‚úÖ DNS est√° funcionando!"
        echo "üåê Testando aplica√ß√£o..."
        
        if curl -I http://$DOMAIN 2>/dev/null | grep -q "200 OK"; then
            echo "üéâ SUCESSO! Aplica√ß√£o est√° acess√≠vel em: http://$DOMAIN"
        else
            echo "‚è≥ DNS funcionando, mas aplica√ß√£o ainda n√£o acess√≠vel. Aguarde alguns segundos..."
        fi
    else
        echo "‚è≥ DNS ainda n√£o propagado. Configure no Duck DNS e aguarde 1-2 minutos."
    fi
}

# Verificar se o usu√°rio quer testar agora
echo
read -p "Deseja verificar se o DNS j√° est√° configurado? (y/n): " -n 1 -r
echo
if [[ $REPLY =~ ^[Yy]$ ]]; then
    check_dns
fi

echo
echo "ü¶Ü DUCK DNS - A melhor alternativa gratuita para DNS!"
